<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_standing</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>spr_hitbox_player</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///constants
global.right = ord('D');
global.left = ord('A');
global.up = ord('W');
global.down = ord('S');
global.left_portal = ord('Q');
global.right_portal = ord('E');
global.jump = ds_list_create();
ds_list_add(global.jump, ord('W'));
ds_list_add(global.jump, vk_space);
global.throw = mb_left;

has_double_jump = true;
enum player_states {
    stationary,
    running,
    jumping,
    wall_slide,
    wall_jump,
    double_jump,
    falling,
    landing,
    rolling,
    death
}

player_state = player_states.stationary;
state_changed = true;

move_speed = 2.5;
air_move_speed = .5;
max_move_speed = 10;
max_absolute_speed = 100;
throw_speed = 30;//???
throw_momentum_percent = .5;
MAX_AMMO = 5;
ammo = MAX_AMMO;
in_air = false;
wall_friction = false;
jump_speed = 9;
double_jump_speed = 9;
jump_time = 12;
steps = 0;
wall_jump_vertical = 1.2;
wall_jump_horizontal = .9;
dampening = .99;//smaller is more dampening
frict = .65;//changes the dampening when in contact with the ground
wfrict = .7;//changes the dampening when holding against a wall
minimum_roll_speed = 1;
min_running_speed = .2;
height=36;
width=18;

gravity_x = 0;
gravity_y = .8;

jumping = false;
vel_x=0;
vel_y=0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Apply general forces
if(player_state != player_states.stationary and player_state != player_states.running and 
    player_state != player_states.rolling and player_state != player_states.landing){
    vel_y+=gravity_y;
}else{
    vel_y = 0;
}
vel_y*=dampening;
vel_x*=dampening;

if(abs(vel_x) &gt; max_absolute_speed)
    vel_x = sign(vel_x) * max_absolute_speed;
if(abs(vel_y) &gt; max_absolute_speed)
    vel_y = sign(vel_y) * max_absolute_speed;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Constant Keypresses

if(mouse_check_button_pressed(global.throw))
{
    if (ammo &gt; 0){
        ammo--;
        var inst = instance_create(x,y,obj_axe);
        with(inst){
            var del_x = mouse_x-x;
            var del_y = mouse_y-y;
            var x_percent =abs(del_x)/(abs(del_x)+abs(del_y));
            vel_x=other.throw_momentum_percent*other.vel_x+sign(del_x)*abs(x_percent*other.throw_speed);
            vel_y=other.throw_momentum_percent*other.vel_y+sign(del_y)*abs((1-x_percent)*other.throw_speed);
            image_xscale=sign(vel_x);
        }
    }
}

if (keyboard_check(global.left_portal)){
    if (instance_number(obj_moving_portal) &lt; 1){
        var inst = instance_create(x,y,obj_moving_portal);//TODO find wall
        with(inst){
            sprite_index = spr_moving_left_portal;
            var x_vec = mouse_x - x;
            var y_vec = mouse_y - y;
            var x_percent = abs(x_vec)/(abs(x_vec)+abs(y_vec));
            vel_x = sign(x_vec)*abs(x_percent * travel_speed);
            vel_y = sign(y_vec)*abs((1-x_percent) * travel_speed);
            image_angle = radtodeg(arctan(vel_y / -vel_x));
            portal_id=0;
        }
    }
}

if (keyboard_check(global.right_portal)){
    if (instance_number(obj_moving_portal) &lt; 1){
        var inst = instance_create(x,y,obj_moving_portal);//TODO find wall
        with(inst){
            sprite_index = spr_moving_right_portal;
            var x_vec = mouse_x - x;
            var y_vec = mouse_y - y;
            var x_percent = abs(x_vec)/(abs(x_vec)+abs(y_vec));
            vel_x = sign(x_vec)*abs(x_percent * travel_speed);
            vel_y = sign(y_vec)*abs((1-x_percent) * travel_speed);
            image_angle = radtodeg(arctan(vel_y / -vel_x));
            portal_id=1;
        }
    }
}

</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Stationary
if (player_state == player_states.stationary and player_state != player_states.death){
if(state_changed){
    state_changed = false;
    sprite_index = spr_standing;
    image_speed = .2;
}

if( keyboard_check(global.left)){
    if(! keyboard_check(global.right)){
        vel_x-=move_speed;
        player_state = player_states.running;
        state_changed= true;
        
    }
}

if( keyboard_check(global.right)){
    if(! keyboard_check(global.left)){
        vel_x+=move_speed;
        player_state = player_states.running;
        state_changed= true;
    }
}

if (keyboard_check_pressed_any(global.jump)){
    player_state = player_states.jumping;
    state_changed= true;
}

if (!check_collision(x,y+1, object_index)){
    player_state = player_states.falling;
    state_changed = true;
}


}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///running
if (player_state == player_states.running and player_state != player_states.death){
if(state_changed){
    sprite_index = spr_walking;
    state_changed = false;
    image_speed = .3;
}
vel_x*=frict;
if( keyboard_check(global.left)){
    if(! keyboard_check(global.right)){
        vel_x-=move_speed;        
        image_xscale = -1;
    }
}

if( keyboard_check(global.right)){
    if(! keyboard_check(global.left)){
        vel_x+=move_speed;
        image_xscale = 1;
    }
}

if (!check_collision(x,y+1, object_index)){
    player_state = player_states.falling;
    state_changed = true;
}

if (keyboard_check_pressed_any(global.jump)){
    player_state = player_states.jumping;
    state_changed= true;
}

if(!state_changed){
    if(abs(vel_x) &lt; min_running_speed){
        vel_x = 0;
        state_changed = true;
        player_state = player_states.stationary;
    }
}

}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Jumping
if(player_state = player_states.jumping and player_state != player_states.death){

    if( state_changed){
        sprite_index = spr_jumping;
        steps = 0;
        state_changed = false
    }
    if( keyboard_check(global.left)){
        if(! keyboard_check(global.right)){
            vel_x-=air_move_speed;   
            image_xscale = -1;     
        }
    }

    if( keyboard_check(global.right)){
        if(! keyboard_check(global.left)){
            vel_x+=air_move_speed;
            image_xscale = 1;
        }
    }
    if( keyboard_check_released_any(global.jump) or steps &gt; jump_time or check_collision(x,y-1, object_index)){
        state_changed = true;
        player_state = player_states.falling;
    }
    if( steps% 2 == 1){
        vel_y-=(jump_speed/steps);
    }
    steps++;

}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Falling

if(player_state == player_states.falling and player_state != player_states.death){
    if(state_changed){
        //TODO: different animation?
        if(sprite_index == spr_walking)
            sprite_index = spr_jumping;
        state_changed = false;
    }
    if( keyboard_check_pressed_any(global.jump)){
        if(has_double_jump){
            state_changed = true;
            player_state = player_states.double_jump;
        }
    }
    if( keyboard_check(global.left)){
        if(! keyboard_check(global.right)){
            vel_x-=air_move_speed;        
        }
    }
    if( keyboard_check(global.right)){
        if(! keyboard_check(global.left)){
            vel_x+=air_move_speed;
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Landing
if(player_state == player_states.landing and player_state != player_states.death){
    if( state_changed){
        has_double_jump = true;
        if( keyboard_check(global.down) and abs(vel_x) &gt; minimum_roll_speed){//TODO: do we want a minimum roll speed
            player_state = player_states.rolling;
            state_changed = true;
        }
        else {
            //TODO:apply dampening
            sprite_index = spr_landing;
            image_speed = .6;
            state_changed = false;
        }
    }else {
        vel_x*=.5;
    }
    
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///rolling
if(player_state == player_states.rolling and player_state != player_states.death){
    if(state_changed) {
        //TODO: start animation
        //TODO: physics?
            sprite_index = spr_rolling;
            image_speed = 1;
        state_changed = false;
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///wall_sliding
if(player_state == player_states.wall_slide and player_state != player_states.death){
    if(state_changed) {
        sprite_index = spr_sliding;
        image_speed = 0.5;
        state_changed = false;
    }
    if( keyboard_check(global.left)){
        image_xscale = 1;
        if(! keyboard_check(global.right)){
            vel_x-=air_move_speed;
            if(!check_collision(x-1,y,object_index)){
                player_state = player_states.falling;
                state_changed = true;
            }
        }
    }
    
    if( keyboard_check(global.right)){
        image_xscale = -1;
        if(! keyboard_check(global.left)){
            vel_x+=air_move_speed;
            if(!check_collision(x+1,y,object_index)){
                player_state = player_states.falling;
                state_changed = true;
            }
        }
    }
    
    if( ! keyboard_check(global.left) and ! keyboard_check(global.right)){
        player_state = player_states.falling;
        state_changed = true;
    }
    
    if( keyboard_check_pressed_any(global.jump) || (keyboard_check(global.left) and keyboard_check(global.right))) {
        state_changed = true;
        player_state = player_states.wall_jump;
    }
    
    if(!state_changed){
        vel_y*=wfrict;
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///wall_jump
if(player_state == player_states.wall_jump and player_state != player_states.death){
    if(state_changed){
        if(check_collision(x+1,y,object_index)){
            vel_x-=wall_jump_horizontal*jump_speed;
        }else {
            vel_x+=wall_jump_horizontal*jump_speed;
        }
        vel_y-=wall_jump_vertical*jump_speed;
        sprite_index = spr_jumping;
        //TODO: make &amp; start animation
        state_changed = true;
        player_state = player_states.falling;
    }
    
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///double jump
if(player_state == player_states.double_jump and player_state != player_states.death){
    if(state_changed){
        //TODO:Change animation
        if(vel_y &gt;0){
            vel_y = 0;
        }
        has_double_jump =false;
        vel_y -=double_jump_speed;
        player_state = player_states.falling;
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Death

if(player_state == player_states.death){
    if(state_changed){
        sprite_index = spr_dying;
        state_changed=false;
    }

}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Update Position

result = move(object_index, vel_x,vel_y);
vert_col = result % 2 == 1;
horz_col = (result div 2) % 2 == 1;
if (horz_col){
    if(!place_meeting(x,y,obj_portal_left) &amp;&amp; ! place_meeting(x,y,obj_portal_right) || x==xprevious)
        vel_x = 0;
    if(vel_y &gt; 0 and player_state!=player_states.death){//Moving Down
        state_changed=true;
        player_state = player_states.wall_slide;
    }
}

if(vert_col){
    if(player_state!=player_states.death &amp;&amp; vel_y &gt; 0){
        state_changed = true;
        player_state = player_states.landing;
    }
    if(!place_meeting(x,y,obj_portal_left) &amp;&amp; ! place_meeting(x,y,obj_portal_right) || y==yprevious)
        vel_y = 0;
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="obj_portal_clear">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with(obj_moving_portal){
    instance_destroy();
}

with(obj_portal_right){
    instance_destroy();
}

with(obj_portal_left){
    instance_destroy();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="7">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (player_state == player_states.landing){
    player_state = player_states.stationary;
    state_changed = true;
}
if (player_state == player_states.rolling){
    player_state = player_states.running;
    state_changed = true;
}

if (player_state == player_states.death){
    image_speed = 0;
    image_index = image_number - 1;
    instance_create(0,0,obj_fade);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>do_lightning();
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>1</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
